apiVersion: triggers.tekton.dev/v1beta1
kind: EventListener
metadata:
  labels:
    rht-gitops.com/janus-argocd: my-quarkus-demo-app-dev-build
  name: my-quarkus-demo-app-el
  namespace: my-quarkus-demo-app-dev
spec:
  namespaceSelector: {}
  resources: {}
  serviceAccountName: pipeline
  triggers:
  - bindings:
    - kind: TriggerBinding
      ref: merge-binding
    interceptors:
    - params:
      - name: filter
        #value: body.object_kind == 'merge_request'
        value: body.object_kind == 'merge_request' && body.object_attributes.state == 'merged'
      - name: overlays
        value: null
      ref:
        kind: ClusterInterceptor
        name: cel
    name: merge-trig
    template:
      ref: my-quarkus-demo-app-run-build
  - bindings:
    - kind: TriggerBinding
      ref: commit-binding
    interceptors:
    - params:
      - name: filter
        #value: has(body.commits) && body.object_kind == 'push'
        value: body.object_kind == 'merge_request' && body.object_attributes.state == 'opened'
      - name: overlays
        value: null
      ref:
        kind: ClusterInterceptor
        name: cel
    name: commit-trig
    template:
      ref: my-quarkus-demo-preview-app-run-build
  - bindings:
    - kind: TriggerBinding
      ref: tag-binding-preprod
    interceptors:
    - params:
      - name: filter
        value: body.object_kind == 'tag_push'
      - name: overlays
        value:
        - expression: body.ref.split('/')[2]
          key: tag_version
      ref:
        kind: ClusterInterceptor
        name: cel
    name: tag-trig-preprod
    template:
      ref: my-quarkus-demo-app-run-promote
  - bindings:
    - kind: TriggerBinding
      ref: tag-binding-prod
    interceptors:
    - params:
      - name: filter
        value: body.object_kind == 'release'
      ref:
        kind: ClusterInterceptor
        name: cel
    name: tag-trig-prod
    template:
      ref: my-quarkus-demo-app-run-promote
status:
  address:
    url: http://el-my-quarkus-demo-app-el.my-quarkus-demo-app-dev.svc.cluster.local:8080
  conditions:
  - lastTransitionTime: "2025-09-24T06:57:24Z"
    message: Deployment has minimum availability.
    reason: MinimumReplicasAvailable
    status: "True"
    type: Available
  - lastTransitionTime: "2025-09-24T06:57:24Z"
    message: Deployment exists
    status: "True"
    type: Deployment
  - lastTransitionTime: "2025-09-24T06:57:24Z"
    message: ReplicaSet "el-my-quarkus-demo-app-el-5fb57b6495" has successfully progressed.
    reason: NewReplicaSetAvailable
    status: "True"
    type: Progressing
  - lastTransitionTime: "2025-09-24T06:57:24Z"
    message: EventListener is ready
    status: "True"
    type: Ready
  - lastTransitionTime: "2025-09-24T06:57:24Z"
    message: Service exists
    status: "True"
    type: Service
  configuration:
    generatedName: el-my-quarkus-demo-app-el
