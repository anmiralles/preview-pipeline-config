apiVersion: tekton.dev/v1
kind: Pipeline
metadata:
  name: my-quarkus-demo-preview-app-build
  namespace: my-quarkus-demo-app-dev
spec:
  params:
  - default: https://gitlab-gitlab.apps.cluster-2kpzz.2kpzz.sandbox5399.opentlc.com/development/my-quarkus-demo-app.git
    description: source repo that contains the application code
    name: source-repo
    type: string
  - default: master
    description: source branch to build from
    name: source-branch
    type: string
  - default: quay-2kpzz.apps.cluster-2kpzz.2kpzz.sandbox5399.opentlc.com/quayadmin/my-quarkus-demo-app
    description: reference of the image that will get created
    name: output-image
    type: string
  - name: sonarqube-host-url
    type: string
  - name: sonarqube-project-key
    type: string
  - name: sonarqube-project-secret
    type: string
  - name: cyclonedx-host-url
    type: string
  - name: stackrox-endpoint
    type: string
  - name: stackrox-secret
    type: string
  - name: git-host
    type: string
  - name: git-owner
    type: string
  - name: component-id
    type: string
  - name: common-password-secret
    type: string
  - name: rekor-url
    type: string
  - name: tuf-mirror
    type: string
  - name: certificate-identity
    type: string
  - name: oidc-issuer
    type: string
  results:
  - description: ""
    name: IMAGE_URL
    value: $(tasks.build-sign-image.results.IMAGE_URL)
  - description: ""
    name: IMAGE_DIGEST
    value: $(tasks.build-sign-image.results.IMAGE_DIGEST)
  - description: ""
    name: CHAINS-GIT_URL
    value: $(tasks.git-clone.results.url)
  - description: ""
    name: CHAINS-GIT_COMMIT
    value: $(tasks.git-clone.results.commit)
  tasks:
  - name: git-clone
    params:
    - name: url
      value: $(params.source-repo)
    - name: revision
      value: $(params.source-branch)
    taskRef:
      kind: ClusterTask
      name: git-clone
    workspaces:
    - name: output
      workspace: source-folder
  - name: package
    runAfter:
    - git-clone
    taskRef:
      kind: ClusterTask
      name: maven
    workspaces:
    - name: source
      workspace: source-folder
    - name: maven-settings
      workspace: maven-settings
  - name: scan-source
    params:
    - name: sonarqubeHostUrl
      value: $(params.sonarqube-host-url)
    - name: sonarqubeProjectKey
      value: $(params.sonarqube-project-key)
    - name: sonarqubeProjectSecret
      value: $(params.sonarqube-project-secret)
    runAfter:
    - package
    taskRef:
      kind: Task
      name: scan-code
    workspaces:
    - name: repository
      workspace: source-folder
  - name: build-sign-image
    params:
    - name: IMAGE
      value: $(params.output-image)
    runAfter:
    - scan-source
    taskRef:
      kind: Task
      name: buildah
    workspaces:
    - name: source
      workspace: source-folder
  workspaces:
  - name: source-folder
  - name: maven-settings
  - name: docker-config
  - name: reports
